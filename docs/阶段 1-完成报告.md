# é˜¶æ®µ 1 å®ŒæˆæŠ¥å‘Š

> NanoBot éƒ¨ç½² + K8s MCP

## âœ… å®Œæˆå†…å®¹

### 1. é¡¹ç›®è„šæ‰‹æ¶

```
sre-nanobot/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ pyproject.toml               # Python åŒ…é…ç½®
â”œâ”€â”€ config.example.json          # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ sre_nanobot/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ mcp/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ k8s_server.py        # K8s MCP æœåŠ¡å™¨ (11 ä¸ªå·¥å…·)
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py              # SRE Agent åŸºç±»
â”‚   â”‚   â””â”€â”€ k8s_agent.py         # K8s Agent å®ç°
â”‚   â””â”€â”€ skills/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ k8s_skill.md          # K8s æŠ€èƒ½æ–‡æ¡£
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ test_k8s_mcp.sh          # æµ‹è¯•è„šæœ¬
â””â”€â”€ docs/
    â””â”€â”€ é˜¶æ®µ 1-å®ŒæˆæŠ¥å‘Š.md
```

### 2. K8s MCP æœåŠ¡å™¨

**11 ä¸ªå·¥å…·å…¨éƒ¨å®ç°ï¼š**

| å·¥å…· | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|
| `kubectl_get_pods` | è·å– Pod åˆ—è¡¨ | âœ… |
| `kubectl_get_deployments` | è·å– Deployment | âœ… |
| `kubectl_get_services` | è·å– Service | âœ… |
| `kubectl_get_events` | è·å–äº‹ä»¶ | âœ… |
| `kubectl_get_nodes` | è·å– Node | âœ… |
| `kubectl_get_logs` | è·å–æ—¥å¿— | âœ… |
| `kubectl_describe_pod` | æè¿° Pod | âœ… |
| `kubectl_describe_node` | æè¿° Node | âœ… |
| `kubectl_restart_deployment` | é‡å¯ Deployment | âœ… |
| `kubectl_scale_deployment` | æ‰©ç¼©å®¹ | âœ… |
| `kubectl_get_resource_usage` | èµ„æºä½¿ç”¨ | âœ… |

### 3. K8s Agent

- âœ… Agent åŸºç±»ï¼ˆSREAgentï¼‰
- âœ… K8s Agent å®ç°
- âœ… å‚æ•°éªŒè¯
- âœ… å®¡æ‰¹æ£€æŸ¥ï¼ˆç”Ÿäº§ç¯å¢ƒ/å¤§è§„æ¨¡æ‰©ç¼©å®¹ï¼‰
- âœ… é”™è¯¯å¤„ç†

### 4. é…ç½®æ¨¡æ¿

- âœ… `config.example.json` - å®Œæ•´é…ç½®ç¤ºä¾‹
- âœ… K8s MCP æœåŠ¡å™¨é…ç½®
- âœ… Prometheus é›†æˆé…ç½®ï¼ˆé¢„ç•™ï¼‰
- âœ… é£ä¹¦/é’‰é’‰é€šé“é…ç½®

### 5. æµ‹è¯•è„šæœ¬

- âœ… `test_k8s_mcp.sh` - K8s è¿æ¥æµ‹è¯•
- âœ… MCP æœåŠ¡å™¨å¯åŠ¨æµ‹è¯•

---

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

### 1. å®‰è£…ä¾èµ–

```bash
cd sre-nanobot
pip install -e .
```

### 2. æµ‹è¯• K8s è¿æ¥

```bash
chmod +x scripts/test_k8s_mcp.sh
./scripts/test_k8s_mcp.sh
```

### 3. é…ç½® NanoBot

```bash
# å¤åˆ¶é…ç½®ç¤ºä¾‹
cp config.example.json ~/.nanobot/config.json

# ç¼–è¾‘é…ç½®
vim ~/.nanobot/config.json

# ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š
# - providers.dashscope.apiKey (ä½ çš„ Qwen API å¯†é’¥)
# - channels.feishu.appId/appSecret (é£ä¹¦é…ç½®)
# - tools.mcpServers.k8s.cwd (sre-nanobot è·¯å¾„)
```

### 4. å¯åŠ¨ K8s MCP æœåŠ¡å™¨

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ MCP æœåŠ¡å™¨
python -m sre_nanobot.mcp.k8s_server
```

### 5. å¯åŠ¨ NanoBot ç½‘å…³

```bash
# ç»ˆç«¯ 2ï¼šå¯åŠ¨ç½‘å…³
nanobot gateway
```

### 6. æµ‹è¯•å¯¹è¯

```bash
# ç»ˆç«¯ 3ï¼šCLI æµ‹è¯•
nanobot agent -m "æŸ¥çœ‹ default å‘½åç©ºé—´çš„ Pod"
```

---

## ğŸ¯ æ¼”ç¤ºç”¨ä¾‹

### æŸ¥çœ‹ Pod çŠ¶æ€

```
ç”¨æˆ·ï¼šæŸ¥çœ‹ production å‘½åç©ºé—´çš„ Pod çŠ¶æ€

Agent: 
ğŸ“¦ Pods in production:
NAME                          READY   STATUS    RESTARTS   AGE
api-service-6d8f9c7b5-abc12   1/1     Running   0          2d
api-service-6d8f9c7b5-def34   1/1     Running   0          2d
web-frontend-5c4d3b2a1-xyz98  1/1     Running   0          1d
```

### é‡å¯æœåŠ¡

```
ç”¨æˆ·ï¼šé‡å¯ api-serviceï¼Œnamespace=production

Agent:
âš ï¸ æ£€æµ‹åˆ°ç”Ÿäº§ç¯å¢ƒæ“ä½œï¼Œéœ€è¦å®¡æ‰¹ã€‚
æ“ä½œè¯¦æƒ…ï¼š
- åŠ¨ä½œï¼šé‡å¯ Deployment
- å‘½åç©ºé—´ï¼šproduction
- èµ„æºï¼šapi-service
- å½±å“ï¼šä¼šè§¦å‘æ»šåŠ¨æ›´æ–°ï¼ŒçŸ­æš‚å½±å“æœåŠ¡

è¯·ç¡®è®¤æ˜¯å¦ç»§ç»­ï¼Ÿ[yes/no]

ç”¨æˆ·ï¼šyes

Agent:
âœ… é‡å¯ Deployment `api-service` (namespace: production):
deployment.apps/api-service restarted
```

### æ‰©ç¼©å®¹

```
ç”¨æˆ·ï¼šå°† api-service æ‰©å±•åˆ° 10 ä¸ªå‰¯æœ¬

Agent:
âš ï¸ æ‰©ç¼©å®¹è¶…è¿‡ 10 å‰¯æœ¬ï¼Œéœ€è¦å®¡æ‰¹ã€‚
æ“ä½œè¯¦æƒ…ï¼š
- åŠ¨ä½œï¼šæ‰©ç¼©å®¹ Deployment
- å‘½åç©ºé—´ï¼šproduction
- èµ„æºï¼šapi-service
- å½“å‰å‰¯æœ¬ï¼š3
- ç›®æ ‡å‰¯æœ¬ï¼š10

è¯·ç¡®è®¤æ˜¯å¦ç»§ç»­ï¼Ÿ[yes/no]

ç”¨æˆ·ï¼šyes

Agent:
âœ… æ‰©ç¼©å®¹ Deployment `api-service` åˆ° 10 å‰¯æœ¬:
deployment.apps/api-service scaled
```

### æŸ¥çœ‹æ—¥å¿—

```
ç”¨æˆ·ï¼šæŸ¥çœ‹ api-service-abc123 çš„æœ€å 100 è¡Œæ—¥å¿—

Agent:
ğŸ“œ Logs from `api-service-abc123`:
2026-02-26 14:00:00 INFO  Starting application...
2026-02-26 14:00:01 INFO  Connected to database
2026-02-26 14:00:02 INFO  Server listening on :8080
...
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. K8s æƒé™

ç¡®ä¿æœ‰ä»¥ä¸‹æƒé™ï¼š

```bash
# æœ€å°æƒé™è¦æ±‚
kubectl auth can-i get pods -n production
kubectl auth can-i get deployments -n production
kubectl auth can-i restart deployment -n production
kubectl auth can-i scale deployment -n production
```

### 2. ç”Ÿäº§ç¯å¢ƒå®¡æ‰¹

å½“å‰å®¡æ‰¹æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼ˆè‡ªåŠ¨æ‰¹å‡†ï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦ï¼š

- [ ] é›†æˆé£ä¹¦å®¡æ‰¹æœºå™¨äºº
- [ ] å®ç°å¤šçº§å®¡æ‰¹æµç¨‹
- [ ] æ·»åŠ å®¡æ‰¹è®°å½•å®¡è®¡

### 3. MCP æœåŠ¡å™¨

å½“å‰æ˜¯æœ¬åœ° STDIO æ¨¡å¼ï¼Œæœªæ¥å¯ä»¥ï¼š

- [ ] éƒ¨ç½²ä¸ºè¿œç¨‹ HTTP MCP æœåŠ¡å™¨
- [ ] æ·»åŠ è®¤è¯å’Œæˆæƒ
- [ ] æ”¯æŒå¤šé›†ç¾¤

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `mcp/k8s_server.py` | 450+ | K8s MCP æœåŠ¡å™¨ |
| `agents/k8s_agent.py` | 300+ | K8s Agent |
| `agents/base.py` | 100+ | Agent åŸºç±» |
| `skills/k8s_skill.md` | 150+ | æŠ€èƒ½æ–‡æ¡£ |
| **æ€»è®¡** | **1000+** | |

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼ˆé˜¶æ®µ 2ï¼‰

### Monitor Agent + Prometheus é›†æˆ

- [ ] Prometheus MCP æœåŠ¡å™¨
- [ ] Monitor Agent å®ç°
- [ ] å‘Šè­¦æ¥æ”¶ Webhook
- [ ] æŒ‡æ ‡æŸ¥è¯¢å·¥å…·
- [ ] å‘Šè­¦åˆ†ææµç¨‹

### é¢„è®¡æ—¶é—´ï¼š1 å‘¨

---

## ğŸ“ è”ç³»æ–¹å¼

æœ‰é—®é¢˜è¯·è”ç³»ï¼š
- GitHub Issues: https://github.com/your-org/sre-nanobot/issues
- å†…éƒ¨æ–‡æ¡£ï¼š[è¿ç»´å¹³å°æ–‡æ¡£](./README.md)

---

*é˜¶æ®µ 1 å®Œæˆï¼2026-02-26*
